var b=Object.defineProperty;var u=Object.getOwnPropertySymbols;var f=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable;var d=(n,e,t)=>e in n?b(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,v=(n,e)=>{for(var t in e||(e={}))f.call(e,t)&&d(n,t,e[t]);if(u)for(var t of u(e))p.call(e,t)&&d(n,t,e[t]);return n};var a=(n,e,t)=>(d(n,typeof e!="symbol"?e+"":e,t),t);const w=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}};w();var o=(n=>(n.Paint="paint",n.Zoom="zoom",n.Unzoom="unzoom",n.Drag="drag",n.Erase="erase",n))(o||{});class y{constructor(e,t){a(this,"_zoomValue",1);a(this,"_translate",{x:0,y:0});this._frame=e,this._canvas=t,document.addEventListener("fullscreenchange",s=>{this.fitSketch()})}get zoomValue(){return this._zoomValue}set zoomValue(e){this._zoomValue=e,this._canvas.style.width=this._canvas.width*this._zoomValue+"px";const t=this._frame.getBoundingClientRect();this.translate={x:-(t.width-this._canvas.width*this._zoomValue)/2,y:-(t.height-this._canvas.height*this._zoomValue)/2}}get translate(){return this._translate}set translate(e){this._translate=e,this._canvas.style.setProperty("transform",`translate(${-this._translate.x}px,${-this._translate.y}px)`)}fitSketch(){const{width:e,height:t}=this._frame.getBoundingClientRect(),s=this._canvas.width/this._canvas.height,i=e/t;this.zoomValue=s<i?t/this._canvas.height:e/this._canvas.width}zoom(e,t){let s=this._zoomValue>1?this._zoomValue+1:this._zoomValue*2;if(t&&t<0&&(s=this._zoomValue>1?this._zoomValue-1:this._zoomValue*.5),e){e.x=Math.min(Math.max(e.x,0),this._canvas.width),e.y=Math.min(Math.max(e.y,0),this._canvas.width);const i=e.x*s-e.x*this._zoomValue+this._translate.x,r=e.y*s-e.y*this._zoomValue+this._translate.y;this._translate={x:i,y:r}}this._zoomValue=s,this._canvas.style.width=this._canvas.width*this._zoomValue+"px",this._canvas.style.setProperty("transform",`translate(${-this._translate.x}px,${-this._translate.y}px)`)}drag(e,t){const s=t.x-e.x,i=t.y-e.y;this.translate={x:this.translate.x-s,y:this.translate.y-i}}}class m{constructor(){a(this,"_canvas");a(this,"actif",!0);a(this,"_ctx");this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d")}set width(e){this._canvas.width=e}get width(){return this._canvas.width}set height(e){this._canvas.height=e}get height(){return this._canvas.height}draw(e){this.actif&&e.drawImage(this._canvas,0,0)}resize(e,t){const s=this._ctx.getImageData(0,0,this.width,this.height);this.width=e,this.height=t,this._ctx.putImageData(s,0,0)}paint(e,t,s){this._ctx.fillStyle=s||"#000000",this._ctx.fillRect(Math.floor(e.x),Math.floor(e.y),t||1,t||1)}erase(e,t){this._ctx.clearRect(Math.floor(e.x),Math.floor(e.y),t||1,t||1)}}class g extends m{clear(){this._ctx.clearRect(0,0,this.width,this.height)}}class x extends m{constructor(){super();a(this,"_colors",["#808080","#C0C0C0"]);a(this,"_size",4);this.clear()}clear(){for(let t=0;t<this.height/this._size;t++)for(let s=0;s<this.width/this._size;s++){const i=(s+t)%2;this.paint({x:s*this._size,y:t*this._size},this._size,this._colors[i])}}}class c{constructor(){a(this,"_observers",[]);a(this,"_newId",function*(){let e=0;for(;;)yield e,e++}())}subscribe(e){const t=this._newId.next().value;return this._observers.push({id:t,callback:e}),t}unsubscribe(e){this._observers=this._observers.filter(t=>t.id!==e)}notify(e){this._observers.forEach(t=>t.callback(e))}}class O{constructor(e){a(this,"_clickObservers",new c);a(this,"_rightClickObservers",new c);a(this,"_dragObservers",new c);a(this,"_pointerMoveObservers",new c);a(this,"_pointerUpObservers",new c);a(this,"_pointerOutObservers",new c);a(this,"_zoomObservers",new c);a(this,"_oldPos",null);a(this,"_buttonDown",null);e.addEventListener("pointerdown",t=>{this._handleTouch(t)}),e.addEventListener("pointermove",t=>{this._handleDrag(t)}),e.addEventListener("pointerup",t=>{const s={x:t.clientX,y:t.clientY};this._buttonDown=null,this._pointerUpObservers.notify(s)}),e.addEventListener("pointercancel",t=>{const s={x:t.clientX,y:t.clientY};this._buttonDown=null,this._pointerOutObservers.notify(s)}),e.addEventListener("pointerout",t=>{const s={x:t.clientX,y:t.clientY};this._buttonDown=null,this._pointerOutObservers.notify(s)}),e.addEventListener("wheel",t=>{const s={x:t.clientX,y:t.clientY},i=Math.sign(t.deltaY);this._zoomObservers.notify({pos:s,dir:i})}),e.addEventListener("contextmenu",t=>t.preventDefault())}_handleTouch(e){const t={x:e.clientX,y:e.clientY};this._buttonDown=e.button,this._oldPos=t,e.button===2&&this._rightClickObservers.notify(t),e.button===0&&this._clickObservers.notify(t)}_handleDrag(e){const t={x:e.clientX,y:e.clientY};this._buttonDown===null?this._pointerMoveObservers.notify({oldPos:this._oldPos||{x:-1,y:-1},newPos:t}):this._buttonDown!==null&&this._oldPos&&(this._dragObservers.notify({oldPos:this._oldPos,newPos:t,button:this._buttonDown}),this._oldPos=t)}addObserver(e,t){switch(e){case"click":return this._clickObservers.subscribe(t);case"rightClick":return this._rightClickObservers.subscribe(t);case"drag":return this._dragObservers.subscribe(t);case"pointerMove":return this._pointerMoveObservers.subscribe(t);case"pointerUp":return this._pointerUpObservers.subscribe(t);case"pointerOut":return this._pointerOutObservers.subscribe(t);case"zoom":return this._zoomObservers.subscribe(t);default:return-1}}removeObserver(e,t){switch(e){case"click":return this._clickObservers.unsubscribe(t);case"rightClick":return this._rightClickObservers.unsubscribe(t);case"drag":return this._dragObservers.unsubscribe(t);case"pointerMove":return this._pointerMoveObservers.unsubscribe(t);case"pointerUp":return this._pointerUpObservers.unsubscribe(t);case"pointerOut":return this._pointerOutObservers.unsubscribe(t);case"zoom":return this._zoomObservers.unsubscribe(t);default:return null}}}class z extends HTMLElement{constructor(){super();a(this,"color","#000000");a(this,"_canvas");a(this,"_ctx");a(this,"_drawing");a(this,"_cursor");a(this,"_background");a(this,"_mode",o.Paint);a(this,"_camera");a(this,"_eventsManager");this._canvas=this._createCanvas(),this._ctx=this._canvas.getContext("2d"),this._drawing=new g,this._cursor=new g,this._background=new x,this._camera=new y(this,this._canvas),this._eventsManager=new O(this),this._camera.fitSketch(),this._updatePreview(),this._addEvents()}_createCanvas(){const t=this.attachShadow({mode:"open"}),s=document.createElement("canvas"),i=document.createElement("style");return i.textContent=`
        canvas{
			-ms-interpolation-mode: nearest-neighbor;
			image-rendering: pixelated;    
			background-color: #ffff;
        }
        `,t.appendChild(s),t.appendChild(i),s}set mode(t){for(const s of Object.values(o))s===t&&(this._mode=s)}static get observedAttributes(){return["width","height"]}attributeChangedCallback(t,s,i){if(!i||isNaN(Number(i)))return;const r=Number(i);switch(t){case"width":if(r>=1){const l=this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height);this._canvas.width=r,this._ctx.putImageData(l,0,0),this._drawing.resize(r,this._canvas.height),this._cursor.resize(r,this._canvas.height),this._background.resize(r,this._canvas.height),this._camera.fitSketch()}break;case"height":const h=this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height);this._canvas.height=r,this._ctx.putImageData(h,0,0),this._drawing.resize(this._canvas.width,r),this._cursor.resize(this._canvas.width,r),this._background.resize(this._canvas.width,r),this._camera.fitSketch();break;default:return}}_handleLeftClick(t){const{newPos:s,oldPos:i}=t,r=this._gridCoordinate(s);switch(this._mode){case o.Paint:this._drawing.paint(r,1,this.color),this._updatePreview();break;case o.Zoom:this._camera.zoom(r);break;case o.Unzoom:this._camera.zoom(r,-1);break;case o.Erase:this._drawing.erase(r,1),this._updatePreview();break;case o.Drag:i&&this._camera.drag(i,s);break}}_handleRightClick(t){const s=this._gridCoordinate(t);this._drawing.erase(s,1),this._updatePreview(),this._cursor.actif=!1}_handleZoom(t){const{pos:s,dir:i}=t,r=this._gridCoordinate(s);i>0?this._camera.zoom(r,-1):this._camera.zoom(r,1)}_handleMove(t){const s=this._gridCoordinate(t.newPos);this._mode===o.Paint&&(this._cursor.actif=!0,this._cursor.clear(),this._cursor.paint(s,1,this.color),this._updatePreview())}_addEvents(){this._eventsManager.addObserver("click",t=>{const s=t;this._handleLeftClick({newPos:s})}),this._eventsManager.addObserver("rightClick",t=>{this._handleRightClick(t)}),this._eventsManager.addObserver("pointerUp",()=>{this._cursor.actif=!0}),this._eventsManager.addObserver("drag",t=>{const{button:s,oldPos:i,newPos:r}=t;switch(s){case 1:this._camera.drag(i,r);break;case 2:this._handleRightClick(r);break;default:this._handleLeftClick(v({},t));break}}),this._eventsManager.addObserver("pointerMove",t=>{this._handleMove(t)}),this._eventsManager.addObserver("pointerOut",()=>{this._cursor.actif=!1,this._updatePreview()}),this._eventsManager.addObserver("zoom",t=>{this._handleZoom(t)})}_updatePreview(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._background.draw(this._ctx),this._drawing.draw(this._ctx),this._cursor.draw(this._ctx)}_gridCoordinate({x:t,y:s}){const{left:i,top:r}=this._canvas.getBoundingClientRect(),h=(t-i)/this._camera.zoomValue,l=(s-r)/this._camera.zoomValue;return{x:h,y:l}}}customElements.define("sketch-app",z);const _=document.querySelector("sketch-app"),k=document.querySelectorAll(".controls button"),C=document.getElementById("color"),P=document.getElementById("fullScreen-js"),E=document.getElementById("test");k.forEach(n=>{n.addEventListener("click",e=>{e.preventDefault(),_.mode=n.id})});C.addEventListener("change",n=>{const e=n.target;_.color=e==null?void 0:e.value});P.addEventListener("click",n=>{n.preventDefault(),_.requestFullscreen()});E.addEventListener("click",n=>{_.setAttribute("width","30"),_.setAttribute("height","20")});
